<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        body { padding: 30px; font-family: sans-serif; max-width: 1000px; margin: 0 auto; }
        .section { margin-bottom: 40px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        h2 { margin-top: 0; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .input-group { margin-bottom: 10px; display: flex; gap: 10px; }
        input { padding: 8px; }
        button { padding: 8px 15px; cursor: pointer; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .tag { background: #eee; padding: 5px 10px; border-radius: 20px; display: flex; align-items: center; gap: 5px; }
        .tag button { background: #ff4444; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; padding: 0; line-height: 20px; font-size: 12px; }
        
        /* íšŒì› ìŠ¹ì¸ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>
    <h1>ğŸ›¡ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <a href="/inventory.html">ğŸ“¦ ì¬ê³ ê´€ë¦¬ë¡œ ì´ë™</a> | 
    <a href="/calendar.html">ğŸ“… ë‹¬ë ¥ìœ¼ë¡œ ì´ë™</a>

    <div class="section">
        <h2>âš™ï¸ ê¸°ì´ˆ ë°ì´í„° ê´€ë¦¬ (ë“œë¡­ë‹¤ìš´)</h2>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h3>í’ˆëª©ëª… (Item Name)</h3>
                <div class="input-group">
                    <input type="text" id="new-item" placeholder="ì˜ˆ: íŒŒì´í”„">
                    <button onclick="addOption('itemName', 'new-item')">ì¶”ê°€</button>
                </div>
                <div id="list-itemName" class="tag-container"></div>
            </div>

            <div style="flex: 1;">
                <h3>ì‚¬ì´ì¦ˆ (Size)</h3>
                <div class="input-group">
                    <input type="text" id="new-size" placeholder="ì˜ˆ: 50mm">
                    <button onclick="addOption('size', 'new-size')">ì¶”ê°€</button>
                </div>
                <div id="list-size" class="tag-container"></div>
            </div>

            <div style="flex: 1;">
                <h3>ê¸¸ì´ (Length)</h3>
                <div class="input-group">
                    <input type="text" id="new-length" placeholder="ì˜ˆ: 10m">
                    <button onclick="addOption('length', 'new-length')">ì¶”ê°€</button>
                </div>
                <div id="list-length" class="tag-container"></div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ‘¥ íšŒì› ê°€ì… ìŠ¹ì¸</h2>
        <button onclick="loadPendingUsers()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        <table>
            <thead>
                <tr><th>ì•„ì´ë””</th><th>ë‹‰ë„¤ì„</th><th>ì‹ ì²­ì¼</th><th>ê´€ë¦¬</th></tr>
            </thead>
            <tbody id="user-list"></tbody>
        </table>
    </div>

    <script>
        const API_OPT = '/api/options';
        const API_ADMIN = '/api/admin';

        window.onload = function() {
            loadOptions();
            loadPendingUsers();
        };

        // --- ì˜µì…˜ ê´€ë¦¬ ë¡œì§ ---
        async function loadOptions() {
            const res = await fetch(API_OPT);
            const options = await res.json();
            
            // ì´ˆê¸°í™”
            document.getElementById('list-itemName').innerHTML = '';
            document.getElementById('list-size').innerHTML = '';
            document.getElementById('list-length').innerHTML = '';

            options.forEach(opt => {
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = `
                    ${opt.value}
                    <button onclick="deleteOption('${opt._id}')">x</button>
                `;
                document.getElementById(`list-${opt.type}`).appendChild(tag);
            });
        }

        async function addOption(type, inputId) {
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            if(!value) return;

            const res = await fetch(API_OPT, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type, value })
            });

            if(res.ok) {
                input.value = '';
                loadOptions();
            } else {
                const data = await res.json();
                alert(data.message);
            }
        }

        async function deleteOption(id) {
            if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            await fetch(`${API_OPT}/${id}`, { method: 'DELETE' });
            loadOptions();
        }

        // --- íšŒì› ê´€ë¦¬ ë¡œì§ (ê¸°ì¡´ ìœ ì§€) ---
        async function loadPendingUsers() {
            const res = await fetch(`${API_ADMIN}/pending`);
            const users = await res.json();
            const list = document.getElementById('user-list');
            list.innerHTML = '';

            if (users.length === 0) {
                list.innerHTML = '<tr><td colspan="4">ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            users.forEach(user => {
                list.innerHTML += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.nickname}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>
                            <button onclick="approveUser('${user.username}')" style="background:green; color:white;">ìŠ¹ì¸</button>
                            <button onclick="banUser('${user.username}')" style="background:red; color:white;">ê±°ì ˆ</button>
                        </td>
                    </tr>`;
            });
        }
        
        async function approveUser(username) {
            await fetch(`${API_ADMIN}/approve`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ targetUsername: username })
            });
            alert('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadPendingUsers();
        }

        async function banUser(username) {
            if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            await fetch(`${API_ADMIN}/ban`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ targetUsername: username })
            });
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            loadPendingUsers();
        }
    </script>
</body>
</html>