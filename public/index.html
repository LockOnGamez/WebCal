<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹œìŠ¤í…œ ë¡œê·¸ì¸</title>
    <style>
        body { padding: 50px; font-family: sans-serif; text-align: center; }
        input { padding: 10px; margin: 5px; width: 200px; }
        button { padding: 10px 20px; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>ğŸ”’ ì‹œìŠ¤í…œ ì ‘ê·¼</h1>

    <div id="login-box">
        <h3>ë¡œê·¸ì¸</h3>
        <input type="text" id="login-id" placeholder="ì•„ì´ë””"><br>
        <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸"><br><br>
        <button onclick="login()">ë¡œê·¸ì¸</button>
        <p>ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <button onclick="toggleView()">íšŒì›ê°€ì… ì‹ ì²­</button></p>
    </div>

    <div id="register-box" class="hidden">
        <h3>íšŒì›ê°€ì… ì‹ ì²­</h3>
        <input type="text" id="reg-id" placeholder="ì•„ì´ë””"><br>
        <input type="password" id="reg-pw" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
        <input type="text" id="reg-nick" placeholder="ë‹‰ë„¤ì„"><br><br>
        <button onclick="register()">ì‹ ì²­í•˜ê¸°</button>
        <p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <button onclick="toggleView()">ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°</button></p>
    </div>

    <script>
        function toggleView() {
            document.getElementById('login-box').classList.toggle('hidden');
            document.getElementById('register-box').classList.toggle('hidden');
        }

        // 1. íšŒì›ê°€ì… ì‹ ì²­
        async function register() {
            const username = document.getElementById('reg-id').value;
            const password = document.getElementById('reg-pw').value;
            const nickname = document.getElementById('reg-nick').value;

            const res = await fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password, nickname })
            });
            const data = await res.json();
            alert(data.message);
            if (res.ok) toggleView(); // ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ
        }

        // 2. ë¡œê·¸ì¸
        async function login() {
    const username = document.getElementById('login-id').value;
    const password = document.getElementById('login-pw').value;

    const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    });
    const data = await res.json();

    if (res.ok) {
        // [ì¶”ê°€ëœ ë¶€ë¶„] ë¡œê·¸ì¸í•œ ì‚¬ëŒ ì•„ì´ë””ë¥¼ ë¸Œë¼ìš°ì €ì— ì €ì¥
        localStorage.setItem('username', data.user.username); // â˜… ì´ ì¤„ ì¶”ê°€!
        
        alert("ë¡œê·¸ì¸ ì„±ê³µ! " + data.user.nickname + "ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.");
        
        // ê´€ë¦¬ìë©´ ê´€ë¦¬ìí˜ì´ì§€, ì•„ë‹ˆë©´ ì¬ê³ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
        if (data.user.role === 'admin') {
            // ê´€ë¦¬ìë„ ì¬ê³ ê´€ë¦¬ëŠ” ë´ì•¼ í•˜ë‹ˆ ì¼ë‹¨ ì„ íƒê¶Œì„ ì£¼ê±°ë‚˜ ì¬ê³ í˜ì´ì§€ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
            // ì—¬ê¸°ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë°”ë¡œ ì¬ê³  í˜ì´ì§€ë¡œ ë³´ë‚´ë³¼ê²Œìš”.
            if(confirm("ê´€ë¦¬ì í˜ì´ì§€ë¡œ ê°ˆê¹Œìš”? (ì·¨ì†Œ ëˆ„ë¥´ë©´ ì¬ê³ ê´€ë¦¬ë¡œ ì´ë™)")) {
                location.href = '/admin.html';
            } else {
                location.href = '/inventory.html';
            }
        } else {
            location.href = '/inventory.html'; // ì¼ë°˜ ìœ ì €ëŠ” ë°”ë¡œ ì¬ê³ ê´€ë¦¬ë¡œ
        }
    } else {
        alert(data.message);
    }
}
    </script>
</body>
</html>