<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“¦ ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body { padding: 30px; font-family: 'Pretendard', sans-serif; max-width: 1000px; margin: 0 auto; background-color: #f5f5f5; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        
        .header-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .input-box h3 { margin-top: 0; font-size: 1.1em; color: #444; }
        .input-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        .input-row input, .input-row select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; flex: 1; min-width: 120px; }
        .input-row button { padding: 10px 25px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .input-row button:hover { background: #000; }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        th, td { border-bottom: 1px solid #eee; padding: 15px; text-align: center; }
        th { background: #f8f9fa; color: #555; font-weight: bold; font-size: 0.9em; }
        tr:last-child td { border-bottom: none; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-inc { background: #4CAF50; color: white; border: none; width: 28px; height: 28px; border-radius: 4px; cursor: pointer; }
        .btn-dec { background: #ff9800; color: white; border: none; width: 28px; height: 28px; border-radius: 4px; cursor: pointer; }
        .btn-del { background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.85em; }
        
        .badge { background: #eee; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; color: #666; }
    </style>
</head>
<body>
    <div class="header-box">
        <h1>ğŸ“¦ ì¬ê³  ê´€ë¦¬ í˜„í™©</h1>
        <div>
            <span id="user-display" style="font-weight: bold; margin-right: 10px;"></span>
            <button onclick="location.href='/calendar.html'" style="background-color: #2196F3; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-right: 5px;">ğŸ“… ë‹¬ë ¥ ë³´ëŸ¬ê°€ê¸°</button>
            <button onclick="logout()" style="padding: 8px 15px; border-radius: 4px; cursor: pointer; border: 1px solid #ccc; background: white;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="input-box">
        <h3>â• ìƒˆ ë¬¼í’ˆ ë“±ë¡ (í’ˆëª© x ì‚¬ì´ì¦ˆ x ê¸¸ì´ ì¡°í•©)</h3>
        <div class="input-row">
            <input type="text" id="new-name" placeholder="í’ˆëª©ëª… (ì˜ˆ: ì²­ìƒ‰)">
            <input type="text" id="new-size" placeholder="ì‚¬ì´ì¦ˆ (ì˜ˆ: 1540)">
            <input type="text" id="new-length" placeholder="ê¸¸ì´ (ì˜ˆ: 3600)">
            <input type="number" id="new-qty" placeholder="ìˆ˜ëŸ‰" value="0" style="flex: 0.5; min-width: 70px;">
            <select id="new-category" style="flex: 0.7;">
                <option value="ì›ìì¬">ì›ìì¬</option>
                <option value="ì™„ì œí’ˆ">ì™„ì œí’ˆ</option>
                <option value="ë¶€ìì¬">ë¶€ìì¬</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
            <button onclick="addItem()">ë“±ë¡</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>í’ˆëª©ëª…</th>
                <th>ì‚¬ì´ì¦ˆ</th>
                <th>ê¸¸ì´</th>
                <th>ìˆ˜ëŸ‰</th>
                <th>ìµœê·¼ ìˆ˜ì •ì</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody id="inventory-list">
            </tbody>
    </table>

    <script>
        const API_URL = '/api/inventory';
        const currentUser = localStorage.getItem('username');

        if (!currentUser) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            location.href = '/';
        } else {
            document.getElementById('user-display').innerText = currentUser + "ë‹˜";
            loadItems();
        }

        // 1. ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì‚¬ì´ì¦ˆ, ê¸¸ì´ ì—´ ì¶”ê°€ ë°˜ì˜)
        async function loadItems() {
            try {
                const res = await fetch(API_URL);
                const items = await res.json();
                
                const list = document.getElementById('inventory-list');
                list.innerHTML = '';

                items.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><span class="badge">${item.category || 'ê¸°íƒ€'}</span></td>
                        <td style="font-weight:bold; color: #2c3e50;">${item.name}</td>
                        <td>${item.size || '-'}</td>
                        <td>${item.length || '-'}</td>
                        <td>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <button class="btn-dec" onclick="updateStock('${item._id}', ${item.quantity - 1})">-</button>
                                <span style="font-weight: bold; min-width: 30px;">${item.quantity}</span>
                                <button class="btn-inc" onclick="updateStock('${item._id}', ${item.quantity + 1})">+</button>
                            </div>
                        </td>
                        <td style="font-size: 0.85em; color: #95a5a6;">${item.lastUpdatedBy || '-'}</td>
                        <td>
                            <button class="btn-del" onclick="deleteItem('${item._id}')">ì‚­ì œ</button>
                        </td>
                    `;
                    list.appendChild(tr);
                });
            } catch (err) {
                console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", err);
            }
        }

        // 2. ë¬¼í’ˆ ë“±ë¡ (ì‚¬ì´ì¦ˆ, ê¸¸ì´ í•„ë“œ ì „ì†¡ ì¶”ê°€)
        async function addItem() {
            const name = document.getElementById('new-name').value.trim();
            const size = document.getElementById('new-size').value.trim();
            const length = document.getElementById('new-length').value.trim();
            const quantity = document.getElementById('new-qty').value;
            const category = document.getElementById('new-category').value;

            if(!name) return alert("í’ˆëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”");

            const res = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name, 
                    size: size || "-", // ê°’ì´ ì—†ìœ¼ë©´ í•˜ì´í”ˆ ì²˜ë¦¬
                    length: length || "-", 
                    quantity, 
                    category,
                    username: currentUser 
                })
            });

            if(res.ok) {
                alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('new-name').value = '';
                document.getElementById('new-size').value = '';
                document.getElementById('new-length').value = '';
                document.getElementById('new-qty').value = '0';
                loadItems();
            } else {
                alert("ë“±ë¡ ì‹¤íŒ¨");
            }
        }

        async function updateStock(id, newQty) {
            if(newQty < 0) return alert("ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì‘ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            const res = await fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    quantity: newQty, 
                    username: currentUser 
                })
            });
            if(res.ok) loadItems();
        }

        async function deleteItem(id) {
            if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní•´ë‹¹ í’ˆëª©ì˜ ëª¨ë“  ì‚¬ì´ì¦ˆ/ê¸¸ì´ ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤.")) return;
            const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
            if(res.ok) loadItems();
        }

        function logout() {
            localStorage.removeItem('username');
            location.href = '/';
        }
    </script>
</body>
</html>