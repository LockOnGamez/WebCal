<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”¥ Smart Factory</title>
    <style>
        /* [ì• ë‹ˆë©”ì´ì…˜ ì •ì˜] */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translate3d(0, 20px, 0); }
            to { opacity: 1; transform: translate3d(0, 0, 0); }
        }
        
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.9); }
            70% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* 1. ê¸°ë³¸ ì„¤ì • ë° ë°°ê²½ */
        body { 
            background-color: #0f172a; 
            margin: 0; 
            padding: 20px; 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            color: #f1f5f9; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            /* í˜ì´ì§€ ë¡œë“œ ì‹œ ì „ì²´ í˜ì´ë“œì¸ */
            animation: fadeInUp 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }

        /* 2. í—¤ë” */
        .header { 
            width: 100%; max-width: 500px; margin: 30px 0; text-align: left; 
            /* í—¤ë”ëŠ” ì•½ê°„ ëŠ¦ê²Œ ë“±ì¥ */
            animation: fadeInUp 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }
        .header h1 { 
            font-size: 1.8rem; margin: 0; font-weight: 900; 
            background: linear-gradient(to right, #4ade80, #3b82f6); 
            background-clip: text; 
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        .header p { color: #94a3b8; font-size: 0.95rem; margin-top: 5px; }

        /* 3. ë©”ë‰´ ê·¸ë¦¬ë“œ */
        .menu-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            width: 100%; 
            max-width: 500px; 
        }

        /* 4. ì¹´ë“œ ë””ìì¸ (Glassmorphism + Animation) */
        .menu-card {
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px; 
            padding: 20px; 
            text-align: center; 
            cursor: pointer;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            gap: 12px;
            color: #e2e8f0;
            min-height: 140px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            
            /* ê¸°ë³¸ ìƒíƒœ íŠ¸ëœì§€ì…˜ (ë¶€ë“œëŸ½ê²Œ) */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            /* ìˆœì°¨ì  ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°ê°’ */
            opacity: 0; 
            animation: fadeInUp 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }

        /* [ìˆœì°¨ ë“±ì¥] ê° ì¹´ë“œê°€ 0.1ì´ˆì”© ëŠ¦ê²Œ ë‚˜íƒ€ë‚˜ë„ë¡ ì„¤ì • */
        .menu-card:nth-child(1) { animation-delay: 0.1s; }
        .menu-card:nth-child(2) { animation-delay: 0.15s; }
        .menu-card:nth-child(3) { animation-delay: 0.2s; }
        .menu-card:nth-child(4) { animation-delay: 0.25s; }
        .menu-card:nth-child(5) { animation-delay: 0.3s; }
        .menu-card:nth-child(6) { animation-delay: 0.35s; }

        /* [í˜¸ë²„ íš¨ê³¼] ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ë¶• ëœ¸ */
        .menu-card:hover { 
            transform: translateY(-5px) scale(1.02); 
            background: rgba(40, 55, 80, 0.8);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* [í´ë¦­ íš¨ê³¼] ëˆ„ë¥´ë©´ ì«€ë“í•˜ê²Œ ë“¤ì–´ê° */
        .menu-card:active { 
            transform: scale(0.95); 
            background: rgba(30, 41, 59, 0.9); 
        }

        .menu-card .icon { 
            font-size: 2.8rem; 
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); 
            transition: transform 0.3s ease;
        }
        /* í˜¸ë²„ ì‹œ ì•„ì´ì½˜ë„ ì‚´ì§ ì›€ì§ì„ */
        .menu-card:hover .icon { transform: scale(1.1) rotate(5deg); }

        .menu-card span { font-weight: 700; font-size: 1.1rem; letter-spacing: -0.5px; }

        /* 5. ìƒì‚° ê¸°ë¡ ë²„íŠ¼ (ê°•ì¡°) */
        .card-prod { 
            grid-column: span 2; 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            flex-direction: row; 
            min-height: 100px;
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }
        .card-prod:hover {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            box-shadow: 0 15px 35px -5px rgba(16, 185, 129, 0.6);
        }

        /* 6. ì™„ë£Œ ìƒíƒœ ë²„íŠ¼ */
        .btn-active { border: 1px solid rgba(59, 130, 246, 0.5); }
        .btn-done { 
            background: rgba(15, 23, 42, 0.5); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            color: #64748b; 
            cursor: default;
        }
        .btn-done:hover { transform: none; box-shadow: none; background: rgba(15, 23, 42, 0.5); }
        .btn-done:active { transform: none; }
        .btn-done .icon { filter: grayscale(100%); opacity: 0.5; }

        /* ê´€ë¦¬ì ë²„íŠ¼ */
        .card-admin { 
            grid-column: span 2; 
            background: rgba(99, 102, 241, 0.1); 
            border: 1px dashed rgba(99, 102, 241, 0.4);
            color: #818cf8;
            min-height: 70px;
            flex-direction: row;
        }

        /* 7. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
        .logout-btn {
            margin-top: 40px; 
            padding: 12px 25px;
            background: transparent; 
            color: #64748b; 
            border: 1px solid #334155; 
            border-radius: 50px;
            font-weight: 600; 
            font-size: 0.9rem;
            cursor: pointer; 
            transition: all 0.2s;
            animation: fadeInUp 1s forwards; /* ì²œì²œíˆ ë“±ì¥ */
            animation-delay: 0.5s;
            opacity: 0;
        }
        .logout-btn:hover {
            border-color: #ef4444;
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        .logout-btn:active { transform: scale(0.95); }

        /* ë¡œë”© ë ˆì´ì–´ */
        #loading-layer { 
            display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.95); z-index: 9999; 
            justify-content: center; align-items: center; flex-direction: column; 
            backdrop-filter: blur(10px);
            transition: opacity 0.4s ease; /* ì‚¬ë¼ì§ˆ ë•Œ ë¶€ë“œëŸ½ê²Œ */
        }
        .spinner { width: 45px; height: 45px; border: 4px solid #1e293b; border-top: 4px solid #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loading-layer"><div class="spinner"></div><p style="margin-top:20px; font-weight:bold; color:#94a3b8;">SYSTEM SYNC...</p></div>

    <div class="header">
        <p style="font-size:0.9rem; font-weight:600; color:#64748b; margin-bottom:5px;">FACTORY OS v2.0</p>
        <h1>HELLO, <span id="user-display" style="color:white;">User</span>.</h1>
        <p>ì˜¤ëŠ˜ë„ ì•ˆì „ ì‘ì—… í•˜ì„¸ìš”!</p>
    </div>

    <div class="menu-grid">
        <button class="menu-card btn-active" id="btn-check-in" onclick="handleAttendance('check-in')">
            <div class="icon">â˜€ï¸</div><span>ì¶œê·¼ í•˜ê¸°</span>
        </button>
        <button class="menu-card btn-active" id="btn-check-out" onclick="handleAttendance('check-out')">
            <div class="icon">ğŸŒ™</div><span>í‡´ê·¼ í•˜ê¸°</span>
        </button>

        <button class="menu-card" onclick="location.href='/inventory.html'">
            <div class="icon">ğŸ“¦</div><span>ì¬ê³  í˜„í™©</span>
        </button>
        <button class="menu-card" onclick="location.href='/calendar.html'">
            <div class="icon">ğŸ“…</div><span>ì‘ì—… ë‹¬ë ¥</span>
        </button>

        <button class="menu-card card-prod" onclick="location.href='/production.html'">
            <div class="icon">ğŸ”¨</div><span>ìƒì‚° ë“±ë¡</span>
        </button>

        <button id="admin-menu" class="menu-card card-admin" style="display:none;" onclick="location.href='/admin.html'">
            <div class="icon">ğŸ›¡ï¸</div><span>ê´€ë¦¬ì ì„¤ì •</span>
        </button>
    </div>

    <button class="logout-btn" onclick="logout()">LOGOUT</button>

    <script>
        const currentUser = localStorage.getItem('username');
        const currentNick = localStorage.getItem('nickname');

        window.onload = async () => {
            if (!currentUser) { location.href = '/'; return; }
            document.getElementById('user-display').innerText = currentNick || currentUser;
            
            try {
                await Promise.all([checkAdminStatus(), checkAttendanceStatus()]);
            } catch (err) { console.error(err); }
            finally { 
                // ë¡œë”© ë ˆì´ì–´ë¥¼ ë¶€ë“œëŸ½ê²Œ ì‚¬ë¼ì§€ê²Œ í•¨
                const loader = document.getElementById('loading-layer');
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 400); 
            }
        };

        async function checkAdminStatus() {
            const res = await fetch(`/api/admin/check`);
            const data = await res.json();
            if (data.isAdmin) document.getElementById('admin-menu').style.display = 'flex';
        }

        async function checkAttendanceStatus() {
            const res = await fetch(`/api/attendance/status/${currentUser}`);
            const data = await res.json();
            if (data) {
                if (data.clockIn) updateButtonUI('check-in', data.clockIn);
                if (data.clockOut) updateButtonUI('check-out', data.clockOut);
            }
        }

        function updateButtonUI(type, isoTime) {
            const time = new Date(isoTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const isBtnIn = type === 'check-in';
            const btn = document.getElementById(isBtnIn ? 'btn-check-in' : 'btn-check-out');
            
            btn.onclick = null;
            btn.className = 'menu-card btn-done';
            btn.innerHTML = `
                <div class="icon">${isBtnIn ? 'âœ…' : 'ğŸ '}</div>
                <span style="color:#94a3b8;">${isBtnIn ? 'ì¶œê·¼' : 'í‡´ê·¼'} ì™„ë£Œ</span>
                <small style="font-weight:bold; color:#cbd5e1;">${time}</small>
            `;
        }

        async function handleAttendance(type) {
            const msg = type === 'check-in' ? 'ì˜¤ëŠ˜ í•˜ë£¨ë„ íŒŒì´íŒ…ì…ë‹ˆë‹¤! ì¶œê·¼ ì°ì„ê¹Œìš”?' : 'ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤! í‡´ê·¼ ì°ì„ê¹Œìš”?';
            if (!confirm(msg)) return;
            
            const res = await fetch(`/api/attendance/${type}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: currentUser, nickname: currentNick })
            });
            if (res.ok) location.reload();
        }

        function logout() { localStorage.clear(); location.href = '/'; }
    </script>
</body>
</html>