<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”¥ Smart Factory</title>
    <style>
        /* 1. ë°°ê²½: ê¹Šì€ ë‹¤í¬ ë„¤ì´ë¹„ ìƒ‰ìƒ */
        body { 
            background-color: #0f172a; 
            margin: 0; 
            padding: 20px; 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            color: #f1f5f9; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* 2. í—¤ë”: ê·¸ë¼ë°ì´ì…˜ í…ìŠ¤íŠ¸ íš¨ê³¼ */
        .header { 
            width: 100%; max-width: 500px; margin: 30px 0; text-align: left; 
        }
        .header h1 { 
            font-size: 1.8rem; margin: 0; font-weight: 900; 
            background: linear-gradient(to right, #4ade80, #3b82f6); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        .header p { color: #94a3b8; font-size: 0.95rem; margin-top: 5px; }

        /* 3. ê·¸ë¦¬ë“œ: ë²¤í† (Bento) ë„ì‹œë½ ìŠ¤íƒ€ì¼ ë°°ì¹˜ */
        .menu-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            width: 100%; 
            max-width: 500px; 
        }

        /* 4. ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼: ë°˜íˆ¬ëª… ìœ ë¦¬ ëŠë‚Œ (Glassmorphism) */
        .menu-card {
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px; 
            padding: 20px; 
            text-align: center; 
            cursor: pointer;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            gap: 12px;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            color: #e2e8f0;
            min-height: 140px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* ëˆŒë €ì„ ë•Œ ì«€ë“í•œ ëŠë‚Œ */
        .menu-card:active { transform: scale(0.96); background: rgba(30, 41, 59, 0.9); }

        .menu-card .icon { font-size: 2.8rem; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }
        .menu-card span { font-weight: 700; font-size: 1.1rem; letter-spacing: -0.5px; }

        /* 5. ìƒì‚° ê¸°ë¡ ë²„íŠ¼: ì£¼ì¸ê³µì²˜ëŸ¼ í™”ë ¤í•˜ê²Œ (ê°€ë¡œ 2ì¹¸ ì°¨ì§€) */
        .card-prod { 
            grid-column: span 2; 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            flex-direction: row; 
            min-height: 100px;
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }
        .card-prod .icon { margin-right: 15px; font-size: 2.5rem; }
        .card-prod span { font-size: 1.4rem; }

        /* 6. ì¶œí‡´ê·¼ ë²„íŠ¼ ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .btn-active { border: 1px solid rgba(59, 130, 246, 0.5); }
        .btn-done { background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(255, 255, 255, 0.05); color: #64748b; }
        .btn-done .icon { filter: grayscale(100%); opacity: 0.5; }

        /* ê´€ë¦¬ì ë²„íŠ¼ */
        .card-admin { 
            grid-column: span 2; 
            background: rgba(99, 102, 241, 0.1); 
            border: 1px dashed rgba(99, 102, 241, 0.4);
            color: #818cf8;
            min-height: 70px;
            flex-direction: row;
        }

        /* 7. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
        .logout-btn {
            margin-top: 40px; 
            padding: 12px 25px;
            background: transparent; 
            color: #64748b; 
            border: 1px solid #334155; 
            border-radius: 50px;
            font-weight: 600; 
            font-size: 0.9rem;
            cursor: pointer; 
            transition: 0.2s;
        }
        .logout-btn:active { background: #334155; color: white; }

        /* ë¡œë”© ë ˆì´ì–´ (ë‹¤í¬ ëª¨ë“œ) */
        #loading-layer { 
            display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.9); z-index: 9999; 
            justify-content: center; align-items: center; flex-direction: column; 
            backdrop-filter: blur(5px);
        }
        .spinner { width: 45px; height: 45px; border: 4px solid #1e293b; border-top: 4px solid #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loading-layer"><div class="spinner"></div><p style="margin-top:20px; font-weight:bold; color:#94a3b8;">SYSTEM SYNC...</p></div>

    <div class="header">
        <p style="font-size:0.9rem; font-weight:600; color:#64748b; margin-bottom:5px;">FACTORY OS v2.0</p>
        <h1>HELLO, <span id="user-display" style="color:white;">User</span>.</h1>
        <p>ì˜¤ëŠ˜ë„ ì•ˆì „ ì‘ì—… í•˜ì„¸ìš”!</p>
    </div>

    <div class="menu-grid">
        <button class="menu-card btn-active" id="btn-check-in" onclick="handleAttendance('check-in')">
            <div class="icon">â˜€ï¸</div><span>ì¶œê·¼ í•˜ê¸°</span>
        </button>
        <button class="menu-card btn-active" id="btn-check-out" onclick="handleAttendance('check-out')">
            <div class="icon">ğŸŒ™</div><span>í‡´ê·¼ í•˜ê¸°</span>
        </button>

        <button class="menu-card" onclick="location.href='/inventory.html'">
            <div class="icon">ğŸ“¦</div><span>ì¬ê³  í˜„í™©</span>
        </button>
        <button class="menu-card" onclick="location.href='/calendar.html'">
            <div class="icon">ğŸ“…</div><span>ì‘ì—… ë‹¬ë ¥</span>
        </button>

        <button class="menu-card card-prod" onclick="location.href='/production.html'">
            <div class="icon">ğŸ”¨</div><span>ìƒì‚° ë“±ë¡</span>
        </button>

        <button id="admin-menu" class="menu-card card-admin" style="display:none;" onclick="location.href='/admin.html'">
            <div class="icon">ğŸ›¡ï¸</div><span>ê´€ë¦¬ì ì„¤ì •</span>
        </button>
    </div>

    <button class="logout-btn" onclick="logout()">LOGOUT</button>

    <script>
        const currentUser = localStorage.getItem('username');
        const currentNick = localStorage.getItem('nickname');

        window.onload = async () => {
            if (!currentUser) { location.href = '/'; return; }
            document.getElementById('user-display').innerText = currentNick || currentUser;
            
            try {
                await Promise.all([checkAdminStatus(), checkAttendanceStatus()]);
            } catch (err) { console.error(err); }
            finally { 
                setTimeout(() => document.getElementById('loading-layer').style.display = 'none', 300); 
            }
        };

        async function checkAdminStatus() {
            const res = await fetch(`/api/admin/check`);
            const data = await res.json();
            if (data.isAdmin) document.getElementById('admin-menu').style.display = 'flex';
        }

        async function checkAttendanceStatus() {
            const res = await fetch(`/api/attendance/status/${currentUser}`);
            const data = await res.json();
            if (data) {
                if (data.clockIn) updateButtonUI('check-in', data.clockIn);
                if (data.clockOut) updateButtonUI('check-out', data.clockOut);
            }
        }

        function updateButtonUI(type, isoTime) {
            const time = new Date(isoTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const isBtnIn = type === 'check-in';
            const btn = document.getElementById(isBtnIn ? 'btn-check-in' : 'btn-check-out');
            
            // ì™„ë£Œëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½ (ì–´ë‘¡ê²Œ ì²˜ë¦¬)
            btn.onclick = null;
            btn.className = 'menu-card btn-done';
            btn.innerHTML = `
                <div class="icon">${isBtnIn ? 'âœ…' : 'ğŸ '}</div>
                <span style="color:#94a3b8;">${isBtnIn ? 'ì¶œê·¼' : 'í‡´ê·¼'} ì™„ë£Œ</span>
                <small style="font-weight:bold; color:#cbd5e1;">${time}</small>
            `;
        }

        async function handleAttendance(type) {
            const msg = type === 'check-in' ? 'ì˜¤ëŠ˜ í•˜ë£¨ë„ íŒŒì´íŒ…ì…ë‹ˆë‹¤! ì¶œê·¼ ì°ì„ê¹Œìš”?' : 'ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤! í‡´ê·¼ ì°ì„ê¹Œìš”?';
            if (!confirm(msg)) return;
            
            const res = await fetch(`/api/attendance/${type}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: currentUser, nickname: currentNick })
            });
            if (res.ok) location.reload();
        }

        function logout() { localStorage.clear(); location.href = '/'; }
    </script>
</body>
</html>