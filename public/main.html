<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”¥ Smart Factory</title>
    <style>
        /* [í…Œë§ˆ ë³€ìˆ˜ ì •ì˜] */
        :root {
            /* â˜€ï¸ ê¸°ë³¸: í™”ì´íŠ¸ í…Œë§ˆ (ìˆ˜ì • ì „ ê¹”ë”í•œ ìŠ¤íƒ€ì¼) */
            --bg-color: #f3f4f6;
            --text-main: #1f2937;
            --text-sub: #666666;
            --card-bg: #ffffff;
            --card-border: rgba(0, 0, 0, 0.08);
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --highlight: #3b82f6;
            --btn-hover: #f8f9fa;
        }

        [data-theme="dark"] {
            /* ğŸŒ™ ë‹¤í¬ í…Œë§ˆ (ë”¥ ë„¤ì´ë¹„ & ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜) */
            --bg-color: #0f172a;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --highlight: #60a5fa;
            --btn-hover: rgba(30, 41, 59, 0.9);
        }

        /* [ì• ë‹ˆë©”ì´ì…˜ ì •ì˜] */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translate3d(0, 20px, 0); }
            to { opacity: 1; transform: translate3d(0, 0, 0); }
        }

        /* 1. ê¸°ë³¸ ì„¤ì • */
        body { 
            background-color: var(--bg-color); 
            color: var(--text-main);
            margin: 0; 
            padding: 20px; 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease; /* í…Œë§ˆ ì „í™˜ ë¶€ë“œëŸ½ê²Œ */
            animation: fadeInUp 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }

        /* 2. í—¤ë” ì˜ì—­ */
        .header-wrapper {
            width: 100%; max-width: 500px; 
            display: flex; justify-content: space-between; align-items: flex-start;
            margin: 30px 0;
            animation: fadeInUp 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }
        .header-content { text-align: left; }
        
        .header h1 { 
            font-size: 1.8rem; margin: 0; font-weight: 900; 
            background: linear-gradient(to right, #4ade80, #3b82f6); 
            -webkit-background-clip: text; 
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        .header p { color: var(--text-sub); font-size: 0.95rem; margin-top: 5px; }

        /* í…Œë§ˆ í† ê¸€ ë²„íŠ¼ */
        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-main);
            width: 45px; height: 45px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }
        .theme-toggle:hover { transform: rotate(15deg) scale(1.1); }

        /* 3. ë©”ë‰´ ê·¸ë¦¬ë“œ */
        .menu-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            width: 100%; 
            max-width: 500px; 
        }

        /* 4. ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .menu-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px; 
            padding: 20px; 
            text-align: center; 
            cursor: pointer;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            gap: 12px;
            color: var(--text-main);
            min-height: 140px;
            box-shadow: var(--card-shadow);
            
            backdrop-filter: blur(10px); /* ë‹¤í¬ëª¨ë“œì¼ ë•Œ ìœ ë¦¬ íš¨ê³¼ */
            -webkit-backdrop-filter: blur(10px);

            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            opacity: 0; 
            animation: fadeInUp 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }

        /* ìˆœì°¨ ë“±ì¥ */
        .menu-card:nth-child(1) { animation-delay: 0.1s; }
        .menu-card:nth-child(2) { animation-delay: 0.15s; }
        .menu-card:nth-child(3) { animation-delay: 0.2s; }
        .menu-card:nth-child(4) { animation-delay: 0.25s; }
        .menu-card:nth-child(5) { animation-delay: 0.3s; }
        .menu-card:nth-child(6) { animation-delay: 0.35s; }

        .menu-card:hover { 
            transform: translateY(-5px) scale(1.02); 
            background: var(--btn-hover);
            border-color: var(--highlight);
        }
        .menu-card:active { transform: scale(0.95); }

        .menu-card .icon { 
            font-size: 2.8rem; 
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .menu-card:hover .icon { transform: scale(1.1) rotate(5deg); }
        .menu-card span { font-weight: 700; font-size: 1.1rem; letter-spacing: -0.5px; }

        /* 5. ìƒì‚° ê¸°ë¡ ë²„íŠ¼ (ê°•ì¡°) */
        .card-prod { 
            grid-column: span 2; 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white !important; /* í•­ìƒ í°ìƒ‰ ê¸€ì”¨ */
            flex-direction: row; 
            min-height: 100px;
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }
        .card-prod:hover {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            box-shadow: 0 15px 35px -5px rgba(16, 185, 129, 0.6);
        }

        /* 6. ì™„ë£Œ ìƒíƒœ ë²„íŠ¼ */
        .btn-active { border: 1px solid rgba(59, 130, 246, 0.5); }
        .btn-done { 
            background: rgba(0, 0, 0, 0.05); /* íˆ¬ëª…ë„ ì¡°ì ˆë¡œ ì–‘ìª½ í…Œë§ˆ ëŒ€ì‘ */
            border: 1px solid var(--card-border); 
            color: var(--text-sub); 
            cursor: default;
            box-shadow: none;
        }
        [data-theme="dark"] .btn-done { background: rgba(15, 23, 42, 0.5); }
        
        .btn-done:hover { transform: none; box-shadow: none; }
        .btn-done:active { transform: none; }
        .btn-done .icon { filter: grayscale(100%); opacity: 0.5; }

        /* ê´€ë¦¬ì ë²„íŠ¼ */
        .card-admin { 
            grid-column: span 2; 
            background: rgba(99, 102, 241, 0.1); 
            border: 1px dashed rgba(99, 102, 241, 0.5);
            color: #818cf8;
            min-height: 70px;
            flex-direction: row;
        }

        /* 7. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
        .logout-btn {
            margin-top: 40px; 
            padding: 12px 25px;
            background: transparent; 
            color: var(--text-sub); 
            border: 1px solid var(--text-sub); 
            border-radius: 50px;
            font-weight: 600; 
            font-size: 0.9rem;
            cursor: pointer; 
            transition: all 0.2s;
            animation: fadeInUp 1s forwards;
            animation-delay: 0.5s;
            opacity: 0;
        }
        .logout-btn:hover {
            border-color: #ef4444;
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        .logout-btn:active { transform: scale(0.95); }

        /* ë¡œë”© ë ˆì´ì–´ */
        #loading-layer { 
            display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--bg-color); /* ë°°ê²½ìƒ‰ë„ í…Œë§ˆ ë”°ë¼ê° */
            z-index: 9999; 
            justify-content: center; align-items: center; flex-direction: column; 
            transition: opacity 0.4s ease;
        }
        .spinner { width: 45px; height: 45px; border: 4px solid var(--card-border); border-top: 4px solid #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loading-layer"><div class="spinner"></div><p style="margin-top:20px; font-weight:bold; color:var(--text-sub);">SYSTEM SYNC...</p></div>

    <div class="header-wrapper">
        <div class="header-content">
            <p style="font-size:0.9rem; font-weight:600; color:var(--text-sub); margin-bottom:5px;">FACTORY OS v2.0</p>
            <h1>HELLO, <span id="user-display" style="color:var(--text-main);">User</span>.</h1>
            <p>ì˜¤ëŠ˜ë„ ì•ˆì „ ì‘ì—… í•˜ì„¸ìš”!</p>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">ğŸŒ™</button>
    </div>

    <div class="menu-grid">
        <button class="menu-card btn-active" id="btn-check-in" onclick="handleAttendance('check-in')">
            <div class="icon">â˜€ï¸</div><span>ì¶œê·¼ í•˜ê¸°</span>
        </button>
        <button class="menu-card btn-active" id="btn-check-out" onclick="handleAttendance('check-out')">
            <div class="icon">ğŸŒ™</div><span>í‡´ê·¼ í•˜ê¸°</span>
        </button>

        <button class="menu-card" onclick="location.href='/inventory.html'">
            <div class="icon">ğŸ“¦</div><span>ì¬ê³  í˜„í™©</span>
        </button>
        <button class="menu-card" onclick="location.href='/calendar.html'">
            <div class="icon">ğŸ“…</div><span>ì‘ì—… ë‹¬ë ¥</span>
        </button>

        <button class="menu-card card-prod" onclick="location.href='/production.html'">
            <div class="icon">ğŸ”¨</div><span>ìƒì‚° ë“±ë¡</span>
        </button>

        <button id="admin-menu" class="menu-card card-admin" style="display:none;" onclick="location.href='/admin.html'">
            <div class="icon">ğŸ›¡ï¸</div><span>ê´€ë¦¬ì ì„¤ì •</span>
        </button>
    </div>

    <button class="logout-btn" onclick="logout()">LOGOUT</button>

    <script>
        const currentUser = localStorage.getItem('username');
        const currentNick = localStorage.getItem('nickname');

        // [í…Œë§ˆ ê´€ë¦¬ ë¡œì§]
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark'; // ê¸°ë³¸ê°’ ë‹¤í¬
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeBtn(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeBtn(newTheme);
        }

        function updateThemeBtn(theme) {
            const btn = document.getElementById('theme-btn');
            if(theme === 'dark') {
                btn.innerHTML = 'ğŸŒ™'; // ë‹¤í¬ëª¨ë“œì¼ ë•Œ ë‹¬ ì•„ì´ì½˜
            } else {
                btn.innerHTML = 'â˜€ï¸'; // ë¼ì´íŠ¸ëª¨ë“œì¼ ë•Œ í•´ ì•„ì´ì½˜
            }
        }

        window.onload = async () => {
            initTheme(); // í…Œë§ˆ ì´ˆê¸°í™”

            if (!currentUser) { location.href = '/'; return; }
            document.getElementById('user-display').innerText = currentNick || currentUser;
            
            try {
                await Promise.all([checkAdminStatus(), checkAttendanceStatus()]);
            } catch (err) { console.error(err); }
            finally { 
                const loader = document.getElementById('loading-layer');
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 400); 
            }
        };

        async function checkAdminStatus() {
            const res = await fetch(`/api/admin/check`);
            const data = await res.json();
            if (data.isAdmin) document.getElementById('admin-menu').style.display = 'flex';
        }

        async function checkAttendanceStatus() {
            const res = await fetch(`/api/attendance/status/${currentUser}`);
            const data = await res.json();
            if (data) {
                if (data.clockIn) updateButtonUI('check-in', data.clockIn);
                if (data.clockOut) updateButtonUI('check-out', data.clockOut);
            }
        }

        function updateButtonUI(type, isoTime) {
            const time = new Date(isoTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const isBtnIn = type === 'check-in';
            const btn = document.getElementById(isBtnIn ? 'btn-check-in' : 'btn-check-out');
            
            btn.onclick = null;
            btn.className = 'menu-card btn-done';
            btn.innerHTML = `
                <div class="icon">${isBtnIn ? 'âœ…' : 'ğŸ '}</div>
                <span style="color:var(--text-sub);">${isBtnIn ? 'ì¶œê·¼' : 'í‡´ê·¼'} ì™„ë£Œ</span>
                <small style="font-weight:bold; color:var(--text-sub); opacity:0.8;">${time}</small>
            `;
        }

        async function handleAttendance(type) {
            const msg = type === 'check-in' ? 'ì˜¤ëŠ˜ í•˜ë£¨ë„ íŒŒì´íŒ…ì…ë‹ˆë‹¤! ì¶œê·¼ ì°ì„ê¹Œìš”?' : 'ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤! í‡´ê·¼ ì°ì„ê¹Œìš”?';
            if (!confirm(msg)) return;
            
            const res = await fetch(`/api/attendance/${type}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: currentUser, nickname: currentNick })
            });
            if (res.ok) location.reload();
        }

        function logout() { 
            // 1. í˜„ì¬ ì„¤ì •ëœ í…Œë§ˆë¥¼ ë³€ìˆ˜ì— ì ì‹œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.
            const currentTheme = localStorage.getItem('theme');
            
            // 2. ì €ì¥ì†Œ ì „ì²´ë¥¼ ë¹„ì›ë‹ˆë‹¤. (ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œë¨)
            localStorage.clear(); 
            
            // 3. ì•„ê¹Œ ì €ì¥í•´ë‘” í…Œë§ˆ ì„¤ì •ë§Œ ë‹¤ì‹œ ë³µêµ¬í•©ë‹ˆë‹¤.
            if(currentTheme) {
                localStorage.setItem('theme', currentTheme);
            }
            
            // 4. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            location.href = '/'; 
        }
    </script>
</body>
</html>