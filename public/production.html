<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”¨ ìƒì‚° ê¸°ë¡ ë“±ë¡</title>
    <style>
        body { background-color: #f4f7f9; padding: 10px; font-family: -apple-system, sans-serif; margin: 0; }
        .prod-container { 
            width: 100%; max-width: 500px; margin: 0 auto; background: white; 
            padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); box-sizing: border-box; 
        }
        h1 { font-size: 1.4rem; text-align: center; margin-bottom: 20px; color: #1e293b; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #475569; font-size: 0.95rem; }
        
        /* ëª¨ë°”ì¼ í„°ì¹˜ë¥¼ ìœ„í•´ ë†’ì´ í™•ì¥ */
        select, input { 
            width: 100%; height: 55px; padding: 0 15px; font-size: 17px; 
            border-radius: 12px; border: 1px solid #ddd; background-color: #fff; box-sizing: border-box; 
        }
        
        .tube-selection { display: flex; gap: 15px; padding: 5px 0; }
        .tube-selection label { font-weight: normal; font-size: 1rem; display: flex; align-items: center; gap: 5px; }
        .tube-selection input { width: 22px; height: 22px; }

        .submit-btn { 
            width: 100%; height: 60px; font-size: 1.2rem; background: #28a745; color: white; 
            border: none; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 15px; 
        }
        .submit-btn:active { transform: scale(0.98); }
        .back-link { display: block; text-align: center; margin-top: 20px; color: #64748b; text-decoration: none; }
    </style>
</head>
<body>
    <div class="prod-container">
        <h1>ğŸ”¨ ìƒì‚° ê¸°ë¡ ë“±ë¡</h1>

        <div class="input-group">
            <label>ì‚¬ìš© ì§€ê´€ ì„ íƒ</label>
            <div class="tube-selection">
                <label><input type="radio" name="tubeType" value="ì¢…ì´ì§€ê´€(6)" checked> ì¢…ì´(6)</label>
                <label><input type="radio" name="tubeType" value="ppì§€ê´€(6)"> PP(6)</label>
            </div>
        </div>
        
        <div class="input-group">
            <label>ì‚¬ìš©í•œ ì›ë‹¨</label>
            <select id="select-material"><option value="">ì›ë‹¨ ì„ íƒ</option></select>
        </div>

        <div class="input-group">
            <label>í­ (Width)</label>
            <select id="width"><option value="">í­ ì„ íƒ</option></select>
        </div>

        <div class="input-group">
            <label>ì‚¬ì´ì¦ˆ (ê¸¸ì´)</label>
            <select id="size"><option value="">ì‚¬ì´ì¦ˆ ì„ íƒ</option></select>
        </div>

        <div class="input-group">
            <label>ìƒì‚° ìˆ˜ëŸ‰ (ê°œ)</label>
            <input type="number" id="quantity" placeholder="ìˆ˜ëŸ‰ ì…ë ¥" inputmode="numeric">
        </div>

        <button class="submit-btn" onclick="submitProduction()">ê¸°ë¡ ì €ì¥</button>
        <a href="main.html" class="back-link">ğŸ  ë©”ì¸ í™”ë©´ìœ¼ë¡œ</a>
    </div>

    <script>
        window.onload = async () => {
            try {
                const [invRes, optRes] = await Promise.all([fetch('/api/inventory'), fetch('/api/options')]);
                const inventory = await invRes.json();
                const options = await optRes.json();

                const materialSelect = document.getElementById('select-material');
                inventory.filter(item => item.category === 'ì›ìì¬').forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m._id;
                    opt.dataset.rawName = m.name;
                    opt.textContent = `${m.name} (ì”ì—¬: ${m.quantity})`;
                    materialSelect.appendChild(opt);
                });

                const widthSelect = document.getElementById('width');
                const sizeSelect = document.getElementById('size');
                options.forEach(opt => {
                    const element = document.createElement('option');
                    element.value = opt.value;
                    element.textContent = opt.value;
                    if (opt.type === 'size') widthSelect.appendChild(element);
                    else if (opt.type === 'length') {
                        element.textContent = opt.value + "m";
                        sizeSelect.appendChild(element);
                    }
                });
            } catch (err) { alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
        };

        async function submitProduction() {
            const materialEl = document.getElementById('select-material');
            if (!materialEl.value) return alert("ì›ë‹¨ì„ ì„ íƒí•˜ì„¸ìš”.");
            
            const data = {
                materialId: materialEl.value,
                materialName: materialEl.options[materialEl.selectedIndex].text,
                category: materialEl.options[materialEl.selectedIndex].dataset.rawName,
                width: document.getElementById('width').value,
                size: document.getElementById('size').value.replace('m', ''),
                quantity: parseInt(document.getElementById('quantity').value),
                tubeName: document.querySelector('input[name="tubeType"]:checked').value
            };

            if(!data.width || !data.size || !data.quantity) return alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");

            const res = await fetch('/api/inventory/produce', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if(res.ok) { alert("ì„±ê³µ!"); location.reload(); }
            else { const err = await res.json(); alert("ì—ëŸ¬: " + err.error); }
        }
    </script>
</body>
</html>